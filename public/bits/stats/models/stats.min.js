Terrace.subscribe("bit:stats:loaded",function(n){var H=(H=window.performance||window.webkitPerformance||window.console)&&H.memory&&H;var w=[].slice;var r={counter:1,frameTimes:[],lastSecond:null,lastTime:null,data:{fps:new f,ms:new f,mem:new f}};var A=Math.floor,z=Math.max,y=Math.min,E=Math.round;function f(){return C([],{max:null,min:null})}function I(J){var K=this;return(!K||K.constructor!=I)?new I(J):(J instanceof I)?J:C(K,typeof J=="string"?{type:J}:J)}function G(V){var M,P,L,U,T,J,S,Q,K,O=r.data,R=this,N={};if(!R||R.constructor!=G){return new G(V)}P=document.createElement("div");Q="xstats"+r.counter++;C(R,V||(V={}));R.uid=Q;C(N,R);L=R.fps=C(C({},R.fps),V.fps);J=R.ms=C(C({},R.ms),V.ms);T=R.mem=C(C({},R.mem),V.mem);S=R.padding*2;U=R.height-S;K=R.width-S;M=z(1,E(K*0.02));K=A(K/M);N.titleHeight=E(U*0.28);N.barWidth=M+4;N.fontSize=(N.titleHeight/22.2).toFixed(2);N.innerWidth=M*K;N.innerHeight=U-N.titleHeight;N.padding=E((R.width-N.innerWidth)/2);if(O.ms.length<K){O.fps.length=O.ms.length=O.mem.length=K}b(i(".#{uid},.#{uid} .bg,.#{uid} .fg{width:#{width}px;height:#{height}px}.#{uid} .mi{margin:#{padding}px;width:#{innerWidth}px}.#{uid} p{font-size:#{fontSize}em;height:#{titleHeight}px;width:#{innerWidth}px}.#{uid} ul{height:#{innerHeight}px;width:#{innerWidth}px}.#{uid} li{width:#{barWidth}px}",N)+i(".#{uid}.fps{color:#{fg}}.#{uid}.fps ul{background:#{fg}}.#{uid}.fps .bg,.#{uid}.fps li{background:#{bg}}",C(N,L))+i(".#{uid}.ms{color:#{fg}}.#{uid}.ms ul{background:#{fg}}.#{uid}.ms .bg,.#{uid}.ms li{background:#{bg}}",C(N,J))+i(".#{uid}.mem{color:#{fg}}.#{uid}.mem ul{background:#{fg}}.#{uid}.mem .bg,.#{uid}.mem li{background:#{bg}}",C(N,T)));P.className="xstats "+Q+" "+R.mode;P.innerHTML="<div class=bg></div><div class=mi><p>&nbsp;</p><ul>"+l("<li></li>",K)+"</ul></div><div class=fg></div>";if(typeof P.addEventListener!="undefined"){P.addEventListener("click",a(R),false)}else{if(P.attachEvent!="undefined"){P.attachEvent("onclick",a(R))}}R.element=P;R.canvas=P.getElementsByTagName("ul")[0];R.title=P.getElementsByTagName("p")[0].firstChild;G.subclasses.push(R)}function o(J,K){J.className+=(J.className?" ":"")+K}function b(K){var L,M="cssText",J=r.sheet;if(!J){L=document.getElementsByTagName("head")[0];J=r.sheet=document.createElement("style");J.type="text/css";L.insertBefore(J,L.firstChild)}if(!(L="styleSheet" in J&&J.styleSheet)){M="nodeValue";L=J.firstChild||J.appendChild(document.createTextNode(""))}L[M]+=K}function d(M,L){var J=-1,K=M.length;while(++J<K){if(L(M[J],J,M)===false){break}}return M}function C(J,L){L||(L={});for(var K in L){J[K]=L[K]}return J}function i(K,J){for(var L in J){K=K.replace(RegExp("#\\{"+L+"\\}","g"),J[L])}return K}function q(K,L){var N,M=K.className.split(" "),J=[];while((N=M.pop())){if(L!=N){J.push(N)}}K.className=J.join(" ")}function l(J,K){if(K<1){return""}if(K%2){return l(J,K-1)+J}var L=l(J,K/2);return L+L}function m(K,M){var L=this,J=L.events||(L.events={});d(K.split(" "),function(N){(J[N]||(J[N]=[])).push(M)});return L}function u(N){var P=this,O=I(N),K=(arguments[0]=O,w.call(arguments)),L=P.events,M=L&&L[O.type]||[],J=true;d(M.slice(),function(Q){if(!(J=Q.apply(P,K)!==false)){return J}});return J}function g(K,M){var L=this,J=L.events;d(K.split(" "),function(P){var O=J&&J[P]||[],N=indexOf(O,M);if(N>-1){O.splice(N,1)}});return L}function x(K){var L=this,J=L.events;d(K?K.split(" "):J,function(M){(J&&J[M]||[]).length=0});return L}function a(J){return function(){if(!J.locked){var P=J.mode=="fps"?"ms":J.mode=="ms"?(H?"mem":"fps"):"fps",L=J.element,K=J.canvas.childNodes,O=r.data[P],N=O[0],M=K.length;J.mode=P;k(J,N&&N.value);while(M--){N=O[M];B(J,K[M],N&&N.percent)}q(L,"fps");q(L,"ms");q(L,"mem");o(L,P)}}}function c(M,L){var K=r.data[M],J=y(100,100*(L/(M=="fps"?80:M=="ms"?1000:128)));L=M=="mem"?L.toFixed(2):E(L);K.length=[K.length,K.unshift({value:L,percent:J})][0];L=A(L);K.min=y(K.min!=null?K.min:L,L);K.max=z(K.max!=null?K.max:L,L)}function B(N,M,L){var J=100,P=(J/16)*15,K=(P/100)*L,O=L!=null?(P-K).toFixed(2):J;M.style.height=O+"%"}function k(K,M){var N=K.mode,J=N=="mem"?"MB":N.toUpperCase(),L=r.data[N];K.title.nodeValue=M==null?" ":M+J+" ("+L.min+"-"+L.max+")"}function j(){var N,O=r.data,M=r.frameTimes,P=0,K=new Date,L=K-r.lastSecond,J=new Date-1000;if(r.lastTime!=null){M.push(new Date);c("ms",K-r.lastTime);if(L>999){N=M.length;while(N--){if(M[N]<J){break}P++}c("fps",P);H&&c("mem",H.memory.usedJSHeapSize/1048576);r.frameTimes=M.slice(N);r.lastSecond=K}d(G.subclasses,function(Q){var R=Q.canvas,T=Q.mode,S=O[T][0];if(S&&(T=="ms"||r.lastSecond==K)){k(Q,S.value);B(Q,R.insertBefore(R.lastChild,R.firstChild),S.percent)}})}else{r.lastSecond=K}r.lastTime=K}G.subclasses=[];C(G.prototype,{height:48,width:94,padding:3,locked:false,mode:"fps",sampleRate:0,on:m,fps:{bg:"#282845",fg:"#1affff"},ms:{bg:"#284528",fg:"#1aff1a"},mem:{bg:"#452831",fg:"#ff1a8d"},addListener:m,emit:u,removeAllListeners:x,removeListener:g});I.prototype.type="";G.Event=I;window.xStats=G;H=H&&!!H.memory.usedJSHeapSize&&H;setInterval(j,1000/60);setInterval(function(){var K=r.data,M=K.fps[0],L=K.mem[0],J=K.ms[0];d(G.subclasses,function(N){N.emit("sample",{fps:M&&M.value,mem:L&&L.value,ms:J&&J.value})})},2000);b(".xstats div{position:absolute;overflow:hidden}.xstats p{margin:0;overflow:hidden;font-family:sans-serif;-webkit-text-size-adjust:100%}.xstats ul{margin:0;padding:0;list-style:none;overflow:hidden}.xstats li{float:right;height:100%;margin-left:-4px}.xstats .bg{opacity:.5;filter:alpha(opacity=50)}.xstats{cursor:pointer;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none}");var v=n.params.$get("width");var t=n.params.$get("height");var p=n.params.$get("placement")||"bottomright";var e;var D;var h;var s;switch(p){case"topleft":s=0;e=0;break;case"bottomleft":h=0;e=0;break;case"topright":s=0;D=0;break;case"bottomright":h=0;D=0;break}var F=new G({mode:"ms",height:t||100,width:v||200,padding:10,locked:false,fps:{bg:"#000033",fg:"#ff0000"},ms:{bg:"#000033",fg:"#00ff00"},mem:{bg:"#000033",fg:"#0000ff"}});console.log(n.view);n.view.append(F.element);$(F.element).css({display:"block",position:"absolute",top:s,bottom:h,left:e,right:D,"z-index":100000})});