Terrace.subscribe("bit:rolodex:loaded",function(a){$.fn.listmenu=function(c){var d=$.extend({},$.fn.listmenu.defaults,c);var b=["_","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","-"];return this.each(function(){var v,y,e,n,z={},k,s,j,g=$.extend({},$.fn.listmenu.defaults.cols,d.cols),p=false,w=false,r="";s=this.id;e=$(this);function u(){e.css("visibility","hidden");setTimeout(function(){e.before(i());v=$("#"+s+"-menu");v.append(o());n=$(".lm-letters",v).slice(0,1);if(d.showCounts){k=$(".lm-letter-count",v).slice(0,1)}v.append(x());j=$(".lm-menu",v);h();if(d.flagDisabled){q()}m();if(!d.includeNums){$("._",n).remove()}if(!d.includeOther){$(".-",n).remove()}$(":last",n).addClass("lm-last");v.show()},50)}function t(){k.css({top:$(".a",n).slice(0,1).offset({margin:false,border:true}).top-k.outerHeight({margin:true})})}function q(){for(var B=0;B<b.length;B++){if(z[b[B]]==undefined){$("."+b[B],n).addClass("lm-disabled")}}}function h(){var E=g.gutter,L=g.count,I,H;if(d.menuWidth){I=d.menuWidth}else{I=$(".lm-letters",v).width()-(j.outerWidth()-j.width())}H=(L==1)?I:Math.floor((I-(E*(L-1)))/L);j.width(I);e.width(H);var D,M;e.children().each(function(){str=$(this).text().replace(/\s+/g,"");if(str!=""){firstChar=str.slice(0,1).toLowerCase();if(/\W/.test(firstChar)){firstChar="-"}if(!isNaN(firstChar)){firstChar="_"}}M=$(this).outerHeight();if(z[firstChar]==undefined){z[firstChar]={totHeight:0,count:0,colHeight:0,hasMenu:false}}D=z[firstChar];D.totHeight+=M;D.count++;$.data($(this)[0],s,{firstChar:firstChar,height:M})});$.each(z,function(){this.colHeight=(this.count>1)?Math.ceil(this.totHeight/L):this.totHeight});var K,G,B,F,L={},J;var C=e[0].tagName.toLowerCase();e.children().each(function(){K=$(this);G=$.data(K.get(0),s);F=G.firstChar;B=G.height;if(!z[l=F].hasMenu){j.append('<div class="lm-submenu '+F+'" style="display:none;"></div>');z[F].hasMenu=true}if(L[F]==undefined){L[F]={height:0,colNum:0,itemCount:0,$colRoot:null}}J=L[F];J.itemCount++;if(J.height==0){J.colNum++;$(".lm-submenu."+F,j).append('<div class="lm-col c'+J.colNum+'"><'+C+((C=="ol")?' start="'+J.itemCount+'"':"")+' id="lm-'+s+"-"+F+"-"+J.colNum+'" class="lm-col-root"></'+C+"></div>")}$("#lm-"+s+"-"+F+"-"+J.colNum).append($(this));J.height+=B;if(J.height>=z[F].colHeight){J.height=0}});$.each(z,function(N){if(this.hasMenu){$(".lm-submenu."+N+" .lm-col",j).css({width:H,"float":"left"});$(".lm-submenu."+N+" .lm-col:not(:last)",j).css({marginRight:E})}});j.append('<div class="lm-no-match" style="display:none">'+d.noMatchText+"</div>");e.remove()}function A(B){var C=z[$(B).attr("class").split(" ")[0]];return(C!=undefined)?C.count:0}function f(){if(r!=""){$(".lm-submenu."+r,j).hide()}$(".lm-no-match",j).hide()}function m(){if(d.showCounts){v.mouseover(function(){t()})}$("a",n).click(function(){$(this).blur();return false});n.hover(function(){p=true},function(){p=false;setTimeout(function(){if(!w){$("a.lm-selected",n).removeClass("lm-selected");$(".lm-menu",v).hide();f();r=""}},10)});$("a",n).mouseover(function(){var C=A(this);var F=$(this);if(d.showCounts){var E=F.position().left;var B=F.outerWidth({margin:true});if(d.showCounts){k.css({left:E,width:B+"px"}).text(C).show()}}var D=F.attr("class").split(" ")[0];if(D!=r){if(r!=""){f();$("a.lm-selected",n).removeClass("lm-selected")}F.addClass("lm-selected");if(C>0){$(".lm-submenu."+D,v).show()}else{$(".lm-no-match",v).show()}if(r==""){$(".lm-menu",v).show()}r=D}});$("a",n).mouseout(function(){if(d.showCounts){k.hide()}});j.hover(function(){w=true},function(){w=false;setTimeout(function(){if(!p){$("a.lm-selected",n).removeClass("lm-selected");$(".lm-menu",v).hide();f();r=""}},10)});if(d.onClick!=null){j.click(function(C){var B=$(C.target);d.onClick(B);return false})}}function o(){var C=[];for(var B=1;B<b.length;B++){if(C.length==0){C.push('<a class="_" href="#">0-9</a>')}C.push('<a class="'+b[B]+'" href="#">'+((b[B]=="-")?"...":b[B].toUpperCase())+"</a>")}return'<div class="lm-letters">'+C.join("")+"</div>"+((d.showCounts)?'<div class="lm-letter-count" style="display:none; position:absolute; top:0; left:0; width:20px;">0</div>':"")}function x(){return'<div class="lm-menu"></div>'}function i(){return'<div id="'+s+'-menu" class="lm-wrapper"></div>'}u()})};$.fn.listmenu.defaults={includeNums:true,includeOther:false,flagDisabled:true,noMatchText:"No matching entries",showCounts:true,menuWidth:null,cols:{count:4,gutter:40},onClick:null}});